<!DOCTYPE html>
<html lang="gu">
<head>

       <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Jd Gyan Shala</title>
    <link rel="stylesheet" href="style.css">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+Gujarati:wght@400;700&display=swap" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@400;600&display=swap" rel="stylesheet">
      <title>શાળા ID કાર્ડ જનરેટર</title>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/xlsx/0.17.5/xlsx.full.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.7.1/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jspdf/2.5.1/jspdf.umd.min.js"></script>
    <script src="https://html2canvas.hertzen.com/dist/html2canvas.min.js"></script>
    <script src="https://cdn.jsdelivr.net/npm/jsbarcode@3.11.5/dist/JsBarcode.all.min.js"></script>
  


 
     <style>

* {
    box-sizing: border-box; /* પેડિંગ અને બોર્ડરને પહોળાઈ અને ઊંચાઈમાં સમાવવા */
    margin: 0;
    padding: 0;
}

body {
    font-family: 'Noto Sans Gujarati', sans-serif; /* ગુજરાતી ફોન્ટ */
    line-height: 1.5;
    background-color: #f4f7f6; /* હળવો બેકગ્રાઉન્ડ કલર */
    color: #333;
}

.container {
    width: 90%;
    max-width: 1100px; /* મહત્તમ પહોળાઈ */
    margin: auto; /* મધ્યમાં લાવવા */
    padding: 0 15px; /* બાજુઓથી થોડું પેડિંગ */
    overflow: hidden; /* Clear floats - જો જરૂર હોય તો */
}

a {
    text-decoration: none; /* લિંક નીચેની લાઈન દૂર કરવા */
    color: #007bff; /* લિંક કલર */
    transition: color 0.3s ease; /* હોવર પર કલર ટ્રાન્ઝિશન */
}

a:hover {
    color: #0056b3; /* હોવર પર ડાર્ક કલર */
}

h1, h2, h3, h4, h5 {
    color: #1a5f7a; /* હેડિંગ કલર */
    margin-bottom: 15px;
}

p {
    margin-bottom: 15px;
}
        
        :root {
            --primary-color: #1e3c72;
            --secondary-color: #2a5298;
            --text-primary: #2c3e50;
            --text-secondary: #34495e;
            --card-bg: #ffffff;
        }

        body {
            font-family: 'Noto Sans Gujarati', sans-serif;
            background: #f0f4ff;
            margin: 0;
            padding: 20px;
            min-height: 100vh;
        }
      /* --- હેડર અને ફૂટર --- */
header {
    background: linear-gradient(-45deg, #ee7752, #e73c7e, #23a6d5, #23d5ab);
background-size: 600% 400%;
background-right:100px;
animation: gradientBG 15s ease infinite;
color: white;
padding: 20px;
text-align: center;
font-size: 3.2em;
font-weight: bold;
text-shadow: 6px 6px 4px rgba(0, 0, 0, 0.4); /* halka black shadow */
border-radius: 12px; /* થોડું વધારે ગોળ */
font-family: 'Poppins', sans-serif; /* Stylish modern font */
letter-spacing: 1px; /* Thoda gap har letter ke bich */
}

@keyframes gradientBG {

    0% {background-position: 0% 50%;}
    50% {background-position: 100% 50%;}
    100% {background-position: 0% 50%;}
}

header nav ul {
    display: block;
    text-align: right;
}

header nav ul li {
    list-style-type: disc; /* Bullet laavavu */
    margin-right: 2px; /* Andar space */
}

header nav ul li a {
    color: white;
    font-size: 0.3em;
    text-decoration: none;
}

header nav ul li a:hover {
    color: yellow;
}

footer {
    background: linear-gradient(-45deg, #23d5ab, #23a6d5, #e73c7e, #ee7752);
    background-size: 400% 400%;
    animation: gradientBG 15s ease infinite;
    color: white;
    padding: 20px;
    text-align: center;
}

/* --- હીરો સેક્શન (હોમપેજ) --- */
.hero {
    background: linear-gradient(135deg, #6dd5ed, #2193b0); /* નવો ગ્રેડિયન્ટ */
    color: #fff;
    text-shadow: 6px 6px 4px rgba(0, 0, 0, 0.4); /* halka black shadow */
    letter-spacing: 1px; /* Thoda gap har letter ke bich */
    padding: 60px 0;
    text-align: center;
    margin-bottom: 30px;
    margin-top: 30px;
    border-radius: 12px; /* થોડું વધારે ગોળ */
    border: 2px solid #ffffff50; /* હલકું સફેદ બોર્ડર */
    box-shadow: 8px 8px 16px rgba(0, 0, 0, 0.3); /* નવો શેડો */
    animation: heroFadeIn 2s ease-in-out; /* એનિમેશન લાગુ */
    font-family: 'Poppins', sans-serif; /* નવો ફોન્ટ */
}

.hero h1 {
    font-size: 3em;
    margin-bottom: 15px;
    color: #fff;
    animation: slideInFromTop 1.5s ease-out; /* એડીશનલ એનિમેશન હેડિંગ માટે */
}

.hero p {
    font-size: 1.2em;
    color: #f8f9fa;
    animation: slideInFromBottom 1.5s ease-out; /* પેરાગ્રાફ માટે એનિમેશન */
}

/* એનિમેશન કીફ્રેમ્સ */
@keyframes heroFadeIn {
    0% {
        opacity: 0;
        transform: scale(0.9);
    }
    100% {
        opacity: 1;
        transform: scale(1);
    }
}

@keyframes slideInFromTop {
    0% {
        opacity: 0;
        transform: translateY(-50px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}

@keyframes slideInFromBottom {
    0% {
        opacity: 0;
        transform: translateY(50px);
    }
    100% {
        opacity: 1;
        transform: translateY(0);
    }
}
    .scroll-text {
      width: 100%;
      overflow: hidden;
      white-space: nowrap;
      box-sizing: border-box;
      border-top: 2px solid #ff4081;
      border-bottom: 2px solid #ff4081;
      padding: 10px 0;
      background: linear-gradient(to right, #2b2b2b, #1c1c1c);
    }

    .scroll-text span {
      display: inline-block;
      padding-left: 100%;
      animation: scroll 30s linear infinite;
      font-size: 24px;
      font-weight: bold;
      color: #ffeb3b;
      text-shadow: 2px 2px 5px #000;
    }

    @keyframes scroll {
      0%   { transform: translateX(0%); }
      100% { transform: translateX(-100%); }
    }

        h1 {
            color: var(--primary-color);
            text-align: center;
            padding: 30px 0;
            margin: 0;
            font-size: 2em;
        }

        .upload-section {
            display: flex;
            justify-content: center;
            gap: 5px;
            flex-wrap: wrap;
            margin: 4px 0;
        }

        .action-btn {
            background: #ffffff;
            color: var(--primary-color);
            padding: 12px 30px;
            border-radius: 8px;
            border: 2px solid var(--primary-color);
            cursor: pointer;
            transition: all 0.3s ease;
            display: inline-flex;
            align-items: center;
            gap: 9px;
        }

        .action-btn:hover {
            background: var(--primary-color);
            color: white;
        }

        .i-container {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(370px, 1fr));
           column-gap: 5px;
            padding: 10px;
        }

        .card {
            background: var(--card-bg);
            border-radius: 5px;
            padding: 10px;
            box-shadow: 0 8px 25px rgba(0,0,0,0.1);
            break-inside: avoid-page;
        }

        .school-name {
            text-align: center;
            color: var(--primary-color);
            font-size: 0.95em;
            margin-bottom: 2px;
            font-weight: 600;
        }

        .header {
            display: flex;
            justify-content: space-between;
            align-items: center;
            margin-bottom: 5px;
            padding-bottom: 5px;
            border-bottom: 2px solid var(--primary-color);
        }

        .logo, .photo {
            width: 95px;
            height: 95px;
            border: 2px solid var(--primary-color);
            border-radius: 8px;
            background: #fff;
            overflow: hidden;
            flex-shrink: 0;
        }

        .logo img, .photo img {
            width: 100%;
            height: 100%;
            object-fit: cover;
        }

        .title {
            font-size: 1.3em;
            color: var(--secondary-color);
            text-align: center;
            margin: 0 5px;
            font-weight: 700;
        }

        .details {
            display: grid;
            grid-template-columns: repeat(2, 1fr);
            gap: 2px auto;
            margin-bottom: 4px;
        }

        .info-item {
            display: flex;
            gap: auto;
            align-items: baseline;
        }

        .info-label {
            color: var(--primary-color);
            font-weight: 600;
            flex-shrink: 0;
            font-size: 0.90em;
        }

        .info-value {
            color: var(--text-secondary);
            font-weight: 525;
            word-break: break-word;
            font-size: 0.85em;
        }

        .barcode-container {
            text-align: auto;
            margin: auto;
            height: 50px;
        }
        
        .barcode {
            display: inline-block;
            height: 100%;
        }

        .footer {
            border-top: 1px dashed var(--primary-color);
            padding-top: 5px;
            text-align: center;
            color: var(--text-secondary);
            font-size: 0.8em;
        }

        input[type="file"] {
            display: none;
        }

           .no-photo {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: var(--text-secondary);
            font-size: 0.95em;
             font-weight: 800;
            padding-left: 5px;
        }

        #pdf-progress {
            position: fixed;
            top: 20px;
            left: 50%;
            transform: translateX(-50%);
            background: #ffffff;
            padding: 15px 30px;
            border-radius: 8px;
            box-shadow: 0 4px 15px rgba(0,0,0,0.2);
            z-index: 1000;
            display: none;
        }

        @media print {
            body {
                background: white !important;
            }
            .upload-section {
                display: none !important;
            }
            .card {
                box-shadow: none !important;
                margin: 20px 0 !important;
                -webkit-print-color-adjust: exact;
                print-color-adjust: exact;
            }
        }
    </style>
</head>
<body>
    <header>
    <div class="container">
        <div>GYAN SHALA</div>
        <nav>
            <ul>
                <li><a href="home.html">home</a></li>
                <li><a href="about.html">about us</a></li>
                <li><a href="contact.html">contact</a></li>
                <li><a href="blog.html">બ્લોગ</a></li> </ul>
        </nav>
        <div class="search-container">
            <input type="text" class="search-input" placeholder="શોધો...">
            <button type="submit" class="search-button">શોધો</button>
        </div>
    </div>
</header>


    <main>
        <section class="hero">
            <div class="container">
                <h1> welcome to the my GYAN SHALA</h1>
                <p style = "text.align: center";>સરળતાથી મેનેજ કરો અને એક્સેસ કરો.</p>
            </div>
        </section>
    <main>
         <div class="scroll-text">
    <span>I'd Card બનાવવા માટે home menu માં excel file માં જાઓ ત્યાંથી I'd card excel file download કરો. ત્યારબાદ તેમાં જે જરૂરી માહિતી છે તે ભરો અને excel file ને અહીંયા upload કરો થોડી વાર રાહ જુઓ તમારા I'd card બની જશે.!</span>
  </div>
    <h1>શાળા ID કાર્ડ જનરેટર</h1>
    
    <div class="upload-section">
        <label class="action-btn">
            📷 લોગો અપલોડ
            <input type="file" id="logoUpload" accept="image/*">
        </label>
        <label class="action-btn">
            🖼️ ફોટોની ZIP
            <input type="file" id="photoZip" accept=".zip">
        </label>
        <label class="action-btn">
            📊 Excel ફાઇલ
            <input type="file" id="excelUpload" accept=".xlsx, .xls">
        </label>
        <button class="action-btn" onclick="generatePDF()">📥 PDF/પ્રિન્ટ</button>
    </div>

    <div id="pdf-progress">
        <div id="progress-text">પ્રગતિ: 0%</div>
        <progress value="0" max="100" style="width: 200px;"></progress>
    </div>

    <div class="i-container" id="cards"></div>
      <div class="footer">
    <footer>
    <h2>© 2025 Jd Gyan Shala. All rights reserved.</h2>
    <p style="text-align: center";><a href="Privacy Policy.html">Privacy Policy</a> | <a href="Terms of Service.html">Terms of Service</a></p>
    </footer>
   </div>

    <script>
        let schoolLogo = null;
        let photoMap = {};
        let headerMap = {};
        let schoolName = '';

        // પ્રગતિ સૂચક
        const showProgress = () => document.getElementById('pdf-progress').style.display = 'block';
        const hideProgress = () => document.getElementById('pdf-progress').style.display = 'none';
        const updateProgress = (current, total) => {
            const percent = Math.round((current / total) * 100);
            document.getElementById('progress-text').textContent = `પ્રગતિ: ${percent}%`;
            document.querySelector('#pdf-progress progress').value = percent;
        };
       
         function formatDate(value) {
    if (!value) return '';

    // Excel serial number detection: only if value is a number and large enough
    if (!isNaN(value) && Number(value) > 10000) {
        const excelDate = new Date((Number(value) - 25569) * 86400 * 1000);
        const day = String(excelDate.getUTCDate()).padStart(2, '0');
        const month = String(excelDate.getUTCMonth() + 1).padStart(2, '0');
        const year = excelDate.getUTCFullYear();
        return `${day}/${month}/${year}`;
    }

    // Handle if value is a string date
    const date = new Date(value);
    if (!isNaN(date)) {
        const day = String(date.getDate()).padStart(2, '0');
        const month = String(date.getMonth() + 1).padStart(2, '0');
        const year = date.getFullYear();
        return `${day}/${month}/${year}`;
    }

    // fallback
    return value;
}


        // ફાઇલ અપલોડ હેન્ડલર્સ
        document.getElementById('logoUpload').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = (e) => schoolLogo = e.target.result;
            reader.readAsDataURL(e.target.files[0]);
        });

        document.getElementById('photoZip').addEventListener('change', async function(e) {
            try {
                const zip = await JSZip.loadAsync(e.target.files[0]);
                photoMap = {};
                for(const [filename, file] of Object.entries(zip.files)) {
                    if(!file.dir && filename.match(/\.(jpe?g|png)$/i)) {
                        const blob = await file.async('blob');
                        photoMap[filename.split('/').pop()] = URL.createObjectURL(blob);
                    }
                }
            } catch(error) {
                alert('ZIP ભૂલ: ' + error.message);
            }
        });

        document.getElementById('excelUpload').addEventListener('change', function(e) {
            const reader = new FileReader();
            reader.onload = (e) => {
                try {
                    const workbook = XLSX.read(new Uint8Array(e.target.result), {type: 'array'});
                    processExcelSheet(workbook.Sheets[workbook.SheetNames[0]]);
                } catch(error) {
                    alert('Excel ભૂલ: ' + error.message);
                }
            };
            reader.readAsArrayBuffer(e.target.files[0]);
        });

        // એક્સેલ પ્રોસેસિંગ
        const processExcelSheet = (sheet) => {
    const requiredHeaders = [
        'વિદ્યાર્થીનું નામ (ગુજરાતી)', 'જ.ર.નં','ધોરણ', 'જન્મ તારીખ','પિતાનું નામ','માતાનું  નામ','હાલનું સરનામું','મોબાઈલ','આધાર ડાયસ નંબર'
    ];
    headerMap = {};
    let headerRowIndex = -1;
    let foundSchoolName = false;

    const range = XLSX.utils.decode_range(sheet['!ref']);
    for(let row = range.s.r; row <= range.e.r; row++) {
        const rowData = XLSX.utils.sheet_to_json(sheet, {header: 1, range: row})[0];

        // શાળાનું નામ માટે તપાસો (કેસ-ઇન્સેન્સિટિવ)
        const schoolNameHeaderIndex = rowData.findIndex(cell => String(cell).trim().toLowerCase() === 'શાળાનું નામ');
        if (schoolNameHeaderIndex !== -1 && !foundSchoolName) {
            const schoolNameColumnIndex = schoolNameHeaderIndex + 1; // બાજુની કોલમ
            if (rowData[schoolNameColumnIndex]) {
                schoolName = rowData[schoolNameColumnIndex];
                foundSchoolName = true;
            }
        }

        // Required headers માટે તપાસો
        if(rowData && rowData.filter(cell => requiredHeaders.includes(String(cell).trim())).length >= requiredHeaders.length) {
            requiredHeaders.forEach(header => {
                const index = rowData.findIndex(cell => String(cell).trim() === header);
                if(index !== -1) headerMap[header] = index;
            });
            headerRowIndex = row;
            break;
        }
    }

    if (!schoolName) {
        schoolName = sheet['A1']?.v || 'શાળાનું નામ'; // જો 'શાળાનું નામ' હેડર ન મળે તો પ્રથમ સેલ તપાસો
    }

    if (headerRowIndex !== -1) {
        generateCards(XLSX.utils.sheet_to_json(sheet, {header: 1, range: headerRowIndex + 1}));
    } else {
        alert('જરૂરી હેડર ધરાવતી કોઈ હરોળ મળી નથી.');
    }
};






        // ID કાર્ડ જનરેશન
        const generateCards = (data) => {
    const cardsDiv = document.getElementById('cards');
    cardsDiv.innerHTML = '';
   

    data.forEach((row, index) => {
        const photoFilename = row[headerMap['ફોટો']] || '';
        const photoUrl = photoMap[photoFilename] || '';

        const card = document.createElement('div');
        card.className = 'card';
        card.innerHTML = `
                         <div class="school-name">${schoolName}</div>
            <div class="header">
                <div class="logo">
                    ${schoolLogo ? `<img src="${schoolLogo}" alt="logo">` : '<div class="no-photo">વિદ્યાથી વિકાસ <br>- <br>શાળાથી સંસ્કાર</div>'}
                </div>
                <div class="title">વિદ્યાર્થી ઓળખપત્ર</div>
                <div class="photo">
                    ${photoUrl ? `<img src="${photoUrl}" alt="photo">` : '<div class="no-photo">શિક્ષણથી<br> સિદ્ધિ સુધી</div>'}
                </div>
            </div>
           
            <div class="details">
                <div class="info-item"><span class="info-label">નામ:</span><span class="info-value">${row[headerMap['વિદ્યાર્થીનું નામ (ગુજરાતી)']] || ''}</span></div>
                <div class="info-item"><span class="info-label">જ.ર.નં:</span><span class="info-value">${row[headerMap['જ.ર.નં']] || ''}</span></div>
              <div class="info-item"><span class="info-label">જન્મ તારીખ:</span><span class="info-value">${formatDate(row[headerMap['જન્મ તારીખ']])}</span></div>
              <div class="info-item"><span class="info-label">ધોરણ:</span><span class="info-value">${row[headerMap['ધોરણ']] || ''}</span></div> 
                <div class="info-item"><span class="info-label">પિતાનું નામ:</span><span class="info-value">${row[headerMap['પિતાનું નામ']] || ''}</span></div>
                <div class="info-item"><span class="info-label">માતાનું  નામ:</span><span class="info-value">${row[headerMap['માતાનું  નામ']] || ''}</span></div>
                <div class="info-item"><span class="info-label">સરનામું:</span><span class="info-value">${row[headerMap['હાલનું સરનામું']] || ''}</span></div>
                <div class="info-item"><span class="info-label">મોબાઈલ:</span><span class="info-value">${row[headerMap['મોબાઈલ']] || ''}</span></div>
            </div>
            <div class="barcode-container">
                <svg id="barcode-${index}" class="barcode"></svg>
            </div>
            <div class="footer">આ ઓળખપત્ર ફક્ત શાળા કાર્યો માટે જ માન્ય છે</div>
        `;
        cardsDiv.appendChild(card);

        // Generate barcode
      JsBarcode(`#barcode-${index}`, row[headerMap['આધાર ડાયસ નંબર']]?.trim() || '0000', {
    format: "CODE128",
    width: 2,
    height: 40,
    displayValue: false
	});
      });
}
        // PDF જનરેશન
      const generatePDF = async () => {
    try {
        showProgress();
        const cards = document.querySelectorAll('.card');
        if (!cards.length) throw new Error('પહેલા ID કાર્ડ જનરેટ કરો!');

        const pdf = new jspdf.jsPDF('p', 'mm', 'a4');
        const pageWidth = pdf.internal.pageSize.getWidth();
        const pageHeight = pdf.internal.pageSize.getHeight();

        const cardsPerPage = 8;
        const cardWidth = 85.6;  // Width of each card in mm
        const cardHeight = 54; // Height of each card in mm
        const horizontalSpacing = 25; // Horizontal spacing between cards
        const verticalSpacing = 10;   // Vertical spacing between cards
        const marginLeft = 5;        // Left margin
        const marginTop = 5;         // Top margin

        for (let i = 0; i < cards.length; i++) {
            const card = cards[i];

            // Calculate position on the page
            const positionInPage = i % cardsPerPage;
            const row = Math.floor(positionInPage / 2);
            const col = positionInPage % 2;

            const x = marginLeft + col * (cardWidth + horizontalSpacing);
            const y = marginTop + row * (cardHeight + verticalSpacing);

            // Add a new page for every 8 cards, except before the first page
            if (i > 0 && positionInPage === 0) {
                pdf.addPage();
            }

            // Render the card to canvas
            const canvas = await html2canvas(card, {
                scale: 2,
                useCORS: true,
                onclone: (doc) => {
                    doc.querySelectorAll('.barcode').forEach(barcode => {
                        if (barcode.dataset.value) {
                            JsBarcode(barcode, barcode.dataset.value, { format: "CODE128", height: 40 });
                        }
                    });
                }
            });

            const imgData = canvas.toDataURL('image/png');

            // Calculate image dimensions to fit the card size
            const imgProps = pdf.getImageProperties(imgData);
            const pdfImgWidth = cardWidth;
            const pdfImgHeight = (imgProps.height * pdfImgWidth) / imgProps.width;

            // Add the image to the PDF
            pdf.addImage(imgData, 'PNG', x, y, pdfImgWidth, pdfImgHeight);

            updateProgress(i + 1, cards.length);
        }

        // Save the PDF
        const filename = `ID_Cards_${new Date().toISOString().slice(0, 10)}.pdf`;
        pdf.save(filename);

    } catch (error) {
        alert('PDF ભૂલ: ' + error.message);
    } finally {
        hideProgress();
    }
};
    </script>
</body>
</html>
